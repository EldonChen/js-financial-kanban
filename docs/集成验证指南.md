# 集成验证指南

本文档说明如何验证整个系统的集成情况，包括各个服务的启动和 API 调用测试。

## 前置要求

1. **MongoDB 服务已启动**
   ```bash
   # 使用 Docker（推荐）
   docker run -d -p 27017:27017 --name mongodb mongo:latest
   
   # 或使用本地安装的 MongoDB
   mongod
   ```

2. **所有依赖已安装**
   - Python 服务：`cd services/python-service && uv sync`
   - Node.js 服务：`cd services/node-service && bun install`
   - Rust 服务：`cd services/rust-service && cargo build`
   - 前端：`cd frontend && pnpm install`

3. **环境变量已配置**
   - 复制各服务的 `.env.example` 为 `.env`（如果需要自定义配置）

## 验证步骤

### 1. 启动 MongoDB

```bash
# 检查 MongoDB 是否运行
docker ps | grep mongodb
# 或
nc -z localhost 27017 && echo "MongoDB is running" || echo "MongoDB is not running"
```

### 2. 启动后端服务

#### Python 服务（端口 8000）

```bash
cd services/python-service
uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**验证**：
- 访问 http://localhost:8000/docs 查看 Swagger 文档
- 访问 http://localhost:8000/ 查看服务信息

#### Node.js 服务（端口 3000）

```bash
cd services/node-service
bun run start:dev
```

**验证**：
- 访问 http://localhost:3000/api/v1/ 查看服务信息

#### Rust 服务（端口 8080）

```bash
cd services/rust-service
cargo run
```

**验证**：
- 访问 http://localhost:8080/health 查看健康检查
- 访问 http://localhost:8080/ 查看服务信息

### 3. 启动前端（端口 3001）

```bash
cd frontend
pnpm dev
```

**验证**：
- 访问 http://localhost:3001 查看首页
- 访问 http://localhost:3001/python-items 测试 Python 服务
- 访问 http://localhost:3001/node-items 测试 Node.js 服务
- 访问 http://localhost:3001/rust-items 测试 Rust 服务

### 4. API 测试

#### Python 服务 API 测试

```bash
# 创建 Item
curl -X POST http://localhost:8000/api/v1/items \
  -H "Content-Type: application/json" \
  -d '{"name": "测试项目", "description": "这是一个测试", "amount": 100.0}'

# 获取所有 Items
curl http://localhost:8000/api/v1/items

# 获取单个 Item（替换 {id}）
curl http://localhost:8000/api/v1/items/{id}

# 更新 Item（替换 {id}）
curl -X PUT http://localhost:8000/api/v1/items/{id} \
  -H "Content-Type: application/json" \
  -d '{"name": "更新后的项目", "description": "更新描述", "amount": 200.0}'

# 删除 Item（替换 {id}）
curl -X DELETE http://localhost:8000/api/v1/items/{id}
```

#### Node.js 服务 API 测试

```bash
# 创建 Item
curl -X POST http://localhost:3000/api/v1/items \
  -H "Content-Type: application/json" \
  -d '{"name": "测试项目", "description": "这是一个测试", "amount": 100.0}'

# 获取所有 Items
curl http://localhost:3000/api/v1/items

# 获取单个 Item（替换 {id}）
curl http://localhost:3000/api/v1/items/{id}

# 更新 Item（替换 {id}）
curl -X PUT http://localhost:3000/api/v1/items/{id} \
  -H "Content-Type: application/json" \
  -d '{"name": "更新后的项目", "description": "更新描述", "amount": 200.0}'

# 删除 Item（替换 {id}）
curl -X DELETE http://localhost:3000/api/v1/items/{id}
```

#### Rust 服务 API 测试

```bash
# 创建 Item
curl -X POST http://localhost:8080/api/v1/items \
  -H "Content-Type: application/json" \
  -d '{"name": "测试项目", "description": "这是一个测试", "amount": 100.0}'

# 获取所有 Items
curl http://localhost:8080/api/v1/items

# 获取单个 Item（替换 {id}）
curl http://localhost:8080/api/v1/items/{id}

# 更新 Item（替换 {id}）
curl -X PUT http://localhost:8080/api/v1/items/{id} \
  -H "Content-Type: application/json" \
  -d '{"name": "更新后的项目", "description": "更新描述", "amount": 200.0}'

# 删除 Item（替换 {id}）
curl -X DELETE http://localhost:8080/api/v1/items/{id}
```

## 验证清单

### ✅ 服务启动验证

- [ ] MongoDB 服务正常运行
- [ ] Python 服务成功启动（端口 8000）
- [ ] Node.js 服务成功启动（端口 3000）
- [ ] Rust 服务成功启动（端口 8080）
- [ ] 前端服务成功启动（端口 3001）

### ✅ API 功能验证

#### Python 服务
- [ ] GET /api/v1/items - 获取所有 items
- [ ] GET /api/v1/items/{id} - 获取单个 item
- [ ] POST /api/v1/items - 创建 item
- [ ] PUT /api/v1/items/{id} - 更新 item
- [ ] DELETE /api/v1/items/{id} - 删除 item

#### Node.js 服务
- [ ] GET /api/v1/items - 获取所有 items
- [ ] GET /api/v1/items/{id} - 获取单个 item
- [ ] POST /api/v1/items - 创建 item
- [ ] PUT /api/v1/items/{id} - 更新 item
- [ ] DELETE /api/v1/items/{id} - 删除 item

#### Rust 服务
- [ ] GET /api/v1/items - 获取所有 items
- [ ] GET /api/v1/items/{id} - 获取单个 item
- [ ] POST /api/v1/items - 创建 item
- [ ] PUT /api/v1/items/{id} - 更新 item
- [ ] DELETE /api/v1/items/{id} - 删除 item

### ✅ 前端集成验证

- [ ] 前端可以正常访问 Python 服务 API
- [ ] 前端可以正常访问 Node.js 服务 API
- [ ] 前端可以正常访问 Rust 服务 API
- [ ] 前端页面可以正常创建、查看、编辑、删除 items

### ✅ 数据库验证

- [ ] MongoDB 连接正常
- [ ] 数据可以正常写入和读取
- [ ] 三个服务使用同一个数据库，数据隔离正常

## 常见问题

### MongoDB 连接失败

**问题**：服务启动时提示 MongoDB 连接失败

**解决方案**：
1. 确认 MongoDB 服务已启动：`docker ps | grep mongodb` 或 `mongod`
2. 检查端口是否正确：默认 27017
3. 检查环境变量配置：确认 `.env` 文件中的 `MONGODB_URL` 正确

### 端口冲突

**问题**：服务启动时提示端口已被占用

**解决方案**：
1. 检查端口占用：`lsof -i :8000`（或其他端口）
2. 停止占用端口的进程或修改服务端口配置

### CORS 错误

**问题**：前端调用 API 时出现 CORS 错误

**解决方案**：
1. 确认后端服务的 CORS 配置允许前端域名
2. 检查前端 API URL 配置是否正确

## 自动化测试脚本

可以使用 `scripts/integration-test.sh` 脚本进行自动化集成测试（如果已创建）。

---

**最后更新**：2024年
**文档版本**：1.0
