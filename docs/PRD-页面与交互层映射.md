# PRD - 页面与交互层映射

> **文档版本**：v1.0  
> **创建时间**：2025-01-06  
> **适用项目**：js-financial-kanban

## 1. 信息架构概览

### 1.1 页面层级结构

```
金融看板系统
├── 首页（Dashboard）
├── 股票管理
│   ├── 股票列表页
│   ├── 股票详情页
│   └── 股票更新页（批量操作）
├── Items 管理（可选）
│   ├── Items 列表页
│   └── Items 详情页
├── 设置
│   ├── 账户设置
│   ├── 外观设置
│   └── 通知设置
└── 其他页面
    ├── 认证页面（登录/注册）
    └── 错误页面（404/500）
```

### 1.2 导航结构

```
侧边栏导航（Sidebar）
├── 🏠 Dashboard（首页）
├── 📈 Stocks（股票管理）
│   ├── 股票列表
│   └── 批量更新
├── 📋 Items（可选）
└── ⚙️ Settings（设置）
```

---

## 2. 核心页面设计

### 2.1 Dashboard（首页）

**页面路径**：`/` 或 `/dashboard`

**页面描述**：系统概览页面，展示所有服务的统计信息和最近数据

**功能模块映射**：
- **数据聚合模块** → Dashboard 视图
- **BFF Dashboard View** → 统计数据、最近 Items、最近 Stocks

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Dashboard | [Date Range Picker] [Download]     │
├─────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ Total    │  │ Python   │  │  Node    │  │  Rust    │ │
│  │ Items    │  │ Items    │  │  Items   │  │  Items   │ │
│  │  150     │  │   50     │  │   50     │  │   50     │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
│  ┌──────────┐                                          │
│  │ Total    │                                          │
│  │ Stocks   │                                          │
│  │  500     │                                          │
│  └──────────┘                                          │
├─────────────────────────────────────────────────────────┤
│  Recent Items                                           │
│  ┌──────────────────────────────────────────────────┐ │
│  │ Name | Source | Updated At                        │ │
│  │ Item1| Python | 2024-01-01 10:00                 │ │
│  │ Item2| Node  | 2024-01-01 09:00                 │ │
│  └──────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  Recent Stocks                                          │
│  ┌──────────────────────────────────────────────────┐ │
│  │ Ticker | Name | Market | Updated At              │ │
│  │ AAPL   | Apple| NASDAQ| 2024-01-01 10:00        │ │
│  │ GOOGL  |Google| NASDAQ| 2024-01-01 09:00        │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据刷新**：支持手动刷新按钮
- **时间范围**：支持选择时间范围（7天/30天/全部）
- **数据加载**：显示加载状态，支持骨架屏
- **错误处理**：部分数据加载失败时显示错误提示

**API 调用**：
- `GET /api/bff/v1/views/dashboard`

---

### 2.2 Stocks 列表页

**页面路径**：`/stocks` 或 `/stocks/list`

**页面描述**：股票列表页面，支持搜索、筛选、分页

**功能模块映射**：
- **股票信息管理模块** → 股票查询功能
- **BFF Stocks View** → 股票列表数据

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Stocks | [Search] [Filter] [Refresh] [Update] │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ Ticker | Name | Market | Sector | Updated At    │ │
│  │   ↑    │  ↑   │   ↑    │   ↑    │      ↑         │ │
│  ├──────────────────────────────────────────────────┤ │
│  │ AAPL  │ Apple│ NASDAQ│ Tech  │ 2024-01-01 10:00│ │
│  │ GOOGL │Google│ NASDAQ│ Tech  │ 2024-01-01 09:00│ │
│  │ MSFT  │Micro │ NASDAQ│ Tech  │ 2024-01-01 08:00│ │
│  └──────────────────────────────────────────────────┘ │
│  [< Previous] [1] [2] [3] [Next >]                    │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **搜索功能**：支持按股票代码、名称搜索
- **筛选功能**：支持按市场（A股/港股/美股）、行业筛选
- **排序功能**：支持按更新时间、市值、代码排序
- **分页功能**：支持分页显示，每页 20/50/100 条
- **批量操作**：支持批量更新、批量删除
- **详情跳转**：点击行跳转到股票详情页

**API 调用**：
- `GET /api/bff/v1/views/stocks?page=1&page_size=20&market=美股`

---

### 2.3 Stocks 详情页

**页面路径**：`/stocks/{ticker}` 或 `/stocks/detail?ticker=AAPL`

**页面描述**：单个股票的详细信息页面

**功能模块映射**：
- **股票信息管理模块** → 股票详情查询
- **BFF Stocks View** → 股票详情数据

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: AAPL - Apple Inc. | [Edit] [Update] [Delete]   │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 基本信息                                          │ │
│  │ Ticker: AAPL                                     │ │
│  │ Name: Apple Inc.                                 │ │
│  │ Market: NASDAQ                                   │ │
│  │ Market Type: 美股                                │ │
│  │ Sector: Technology                               │ │
│  │ Industry: Consumer Electronics                   │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 财务指标                                          │ │
│  │ Market Cap: $3,000,000,000,000                   │ │
│  │ P/E Ratio: 30.5                                  │ │
│  │ P/B Ratio: 45.2                                  │ │
│  │ Dividend Yield: 0.5%                              │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 数据源信息                                        │ │
│  │ Data Source: yfinance                           │ │
│  │ Last Updated: 2024-01-01 10:00:00                │ │
│  │ Created At: 2024-01-01 08:00:00                  │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据更新**：支持手动触发数据更新
- **数据编辑**：支持编辑部分字段（如备注）
- **数据删除**：支持删除股票记录
- **返回列表**：支持返回股票列表页

**API 调用**：
- `GET /api/bff/v1/views/stocks/{ticker}`
- `POST /api/v1/stocks/{ticker}/update`
- `DELETE /api/v1/stocks/{ticker}`

---

### 2.4 Stocks 批量更新页

**页面路径**：`/stocks/batch-update` 或 `/stocks/update`

**页面描述**：批量更新股票数据页面，支持实时进度追踪

**功能模块映射**：
- **实时同步模块** → SSE 实时进度推送
- **股票信息管理模块** → 批量更新功能

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Batch Update Stocks                            │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 更新选项                                          │ │
│  │ ☑ Update All Stocks                             │ │
│  │ ☐ Update Selected Stocks                        │ │
│  │ ☐ Update by Market (A股/港股/美股)              │ │
│  │                                                   │ │
│  │ Delay: [1.0] seconds (0.0 - 10.0)                │ │
│  │                                                   │ │
│  │ [Start Update] [Cancel]                          │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 进度信息                                          │ │
│  │ ████████░░░░░░░░░░ 40%                           │ │
│  │                                                   │ │
│  │ Stage: Fetching                                  │ │
│  │ Message: 正在抓取股票信息... (200/500)          │ │
│  │                                                   │ │
│  │ Total: 500                                       │ │
│  │ Current: 200                                     │ │
│  │ Success: 195                                     │ │
│  │ Failed: 5                                        │ │
│  │                                                   │ │
│  │ Elapsed: 3:20                                    │ │
│  │ Estimated: 5:00                                  │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 失败列表（可选）                                  │ │
│  │ INVALID, ERROR, ...                              │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **更新选项**：支持全量更新、选择更新、按市场更新
- **延迟设置**：支持设置抓取延迟（0.0-10.0 秒）
- **实时进度**：使用 SSE 实时显示进度
- **进度可视化**：进度条、百分比、统计信息
- **错误处理**：显示失败列表，支持重试
- **操作控制**：支持取消操作

**API 调用**：
- `POST /api/v1/stocks/fetch-all?delay=1.0`（SSE 流式响应）

**技术实现**：
- 前端使用 `EventSource` API 接收 SSE 事件
- 实时更新进度条和统计信息
- 操作完成后显示结果摘要

---

### 2.5 Items 列表页（可选）

**页面路径**：`/items` 或 `/items/list`

**页面描述**：Items 列表页面，聚合三个服务的 Items 数据

**功能模块映射**：
- **数据聚合模块** → Items 聚合功能
- **BFF Items View** → Items 列表数据

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Items | [Search] [Filter] [Refresh]            │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ Name | Source | Description | Updated At          │ │
│  │   ↑  │   ↑    │      ↑      │      ↑              │ │
│  ├──────────────────────────────────────────────────┤ │
│  │ Item1| Python| Desc1  | 2024-01-01 10:00        │ │
│  │ Item2| Node  | Desc2  | 2024-01-01 09:00        │ │
│  │ Item3| Rust  | Desc3  | 2024-01-01 08:00        │ │
│  └──────────────────────────────────────────────────┘ │
│  [< Previous] [1] [2] [3] [Next >]                    │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据聚合**：自动聚合三个服务的数据
- **去重处理**：按名称去重，保留最新数据
- **排序功能**：按更新时间排序
- **筛选功能**：支持按来源（Python/Node/Rust）筛选

**API 调用**：
- `GET /api/bff/v1/views/items`

---

## 3. 导航与入口关系

### 3.1 主导航（Sidebar）

```
┌─────────────────────┐
│ 🏠 Dashboard         │ → /dashboard
│ 📈 Stocks            │
│   ├─ Stock List      │ → /stocks
│   ├─ Batch Update    │ → /stocks/batch-update
│   └─ Stock Detail    │ → /stocks/{ticker}
│ 📋 Items             │
│   └─ Items List      │ → /items
│ ⚙️ Settings          │
│   ├─ Profile         │ → /settings/profile
│   ├─ Appearance      │ → /settings/appearance
│   └─ Notifications   │ → /settings/notifications
└─────────────────────┘
```

### 3.2 页面跳转关系

```
Dashboard
  ├─→ Stocks List (点击 Recent Stocks)
  ├─→ Items List (点击 Recent Items)
  └─→ Settings

Stocks List
  ├─→ Stock Detail (点击行)
  ├─→ Batch Update (点击批量更新按钮)
  └─→ Dashboard (返回)

Stock Detail
  ├─→ Stocks List (返回)
  ├─→ Batch Update (批量更新)
  └─→ Dashboard (首页)

Batch Update
  ├─→ Stocks List (完成/取消)
  └─→ Dashboard (首页)
```

### 3.3 快捷操作入口

- **Dashboard**：
  - 点击 Recent Stocks → 跳转到 Stocks List
  - 点击 Recent Items → 跳转到 Items List
  - 点击统计卡片 → 跳转到对应列表页

- **Stocks List**：
  - 搜索框 → 实时搜索
  - 筛选器 → 按市场/行业筛选
  - 批量更新按钮 → 跳转到 Batch Update

- **Stock Detail**：
  - 更新按钮 → 触发单个股票更新
  - 删除按钮 → 删除股票记录

---

## 4. 信息层级

### 4.1 一级信息（主要信息）

- **Dashboard**：统计数据、最近数据
- **Stocks List**：股票列表
- **Stock Detail**：股票详细信息

### 4.2 二级信息（辅助信息）

- **数据源信息**：显示数据来源（yfinance、akshare 等）
- **更新时间**：显示最后更新时间
- **操作历史**：显示操作记录（可选）

### 4.3 三级信息（详细信息）

- **财务指标**：P/E、P/B、股息率等
- **市场信息**：交易所、国家、货币等
- **元数据**：创建时间、数据源、版本等

---

## 5. 响应式设计

### 5.1 桌面端（≥ 1024px）

- **布局**：侧边栏 + 主内容区
- **表格**：完整表格，支持排序、筛选
- **详情页**：多列布局，信息完整展示

### 5.2 平板端（768px - 1023px）

- **布局**：可折叠侧边栏 + 主内容区
- **表格**：简化表格，关键信息优先
- **详情页**：单列布局，信息堆叠展示

### 5.3 移动端（< 768px）

- **布局**：底部导航 + 主内容区
- **表格**：卡片式列表，支持下拉刷新
- **详情页**：单列布局，信息分组展示

---

## 6. 交互状态

### 6.1 加载状态

- **骨架屏**：数据加载时显示骨架屏
- **加载指示器**：操作进行中显示加载指示器
- **进度条：批量操作显示进度条

### 6.2 错误状态

- **错误提示**：操作失败显示错误提示
- **重试按钮**：支持重试操作
- **降级处理**：部分数据失败时显示可用数据

### 6.3 空状态

- **空列表**：列表为空时显示空状态提示
- **空搜索**：搜索结果为空时显示提示
- **引导操作**：提供操作引导（如"添加股票"）

---

## 7. 页面优先级

### 7.1 P0 - 核心页面（必须）

- ✅ **Dashboard**：系统概览
- ✅ **Stocks List**：股票列表
- ✅ **Stock Detail**：股票详情
- ✅ **Batch Update**：批量更新

### 7.2 P1 - 重要页面（重要）

- ✅ **Items List**：Items 列表（可选，用于测试）

### 7.3 P2 - 可选页面（可选）

- 🔮 **Settings**：设置页面（已有模板）
- 🔮 **Analytics**：数据分析页面（规划中）

---

**文档维护**：本文档将根据页面开发持续更新
