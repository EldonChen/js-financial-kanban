# PRD - 页面与交互层映射

> **文档版本**：v1.0  
> **创建时间**：2025-01-06  
> **适用项目**：js-financial-kanban

## 1. 信息架构概览

### 1.1 页面层级结构

```
金融看板系统
├── 首页（Dashboard）
├── 股票管理（Stocks）
│   ├── 股票列表页 ✅
│   ├── 股票详情页 ✅
│   ├── 批量更新页 ✅
│   └── 数据支持（二级模块）
│       ├── 历史数据管理页
│       ├── 技术指标计算页
│       ├── 实时行情展示页
│       └── 数据订阅管理页
├── 回测框架（Backtesting）🔮
│   ├── 算法列表页
│   ├── 算法详情页
│   ├── 回测配置页
│   ├── 回测结果页
│   └── 回测分析页
├── Items 管理（可选）
│   ├── Items 列表页
│   └── Items 详情页
├── 设置
│   ├── 账户设置
│   ├── 外观设置
│   └── 通知设置
└── 其他页面
    ├── 认证页面（登录/注册）
    └── 错误页面（404/500）
```

**状态说明**：
- ✅ 已实现
- 🔮 规划中

### 1.2 导航结构

```
侧边栏导航（Sidebar）
├── 🏠 Dashboard（首页）
├── 📈 Stocks（股票管理）
│   ├── 股票列表 ✅
│   ├── 批量更新 ✅
│   └── 数据支持 🔮
│       ├── 历史数据管理
│       ├── 技术指标计算
│       ├── 实时行情
│       └── 数据订阅
├── 📊 Backtesting（回测框架）🔮
│   ├── 算法列表
│   ├── 回测配置
│   ├── 回测结果
│   └── 回测分析
├── 📋 Items（可选）
└── ⚙️ Settings（设置）
```

**状态说明**：
- ✅ 已实现
- 🔮 规划中

---

## 2. 核心页面设计

### 2.1 Dashboard（首页）

**页面路径**：`/` 或 `/dashboard`

**页面描述**：系统概览页面，展示所有服务的统计信息和最近数据

**功能模块映射**：
- **数据聚合模块** → Dashboard 视图
- **BFF Dashboard View** → 统计数据、最近 Items、最近 Stocks

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Dashboard | [Date Range Picker] [Download]     │
├─────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ Total    │  │ Python   │  │  Node    │  │  Rust    │ │
│  │ Items    │  │ Items    │  │  Items   │  │  Items   │ │
│  │  150     │  │   50     │  │   50     │  │   50     │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
│  ┌──────────┐                                          │
│  │ Total    │                                          │
│  │ Stocks   │                                          │
│  │  500     │                                          │
│  └──────────┘                                          │
├─────────────────────────────────────────────────────────┤
│  Recent Items                                           │
│  ┌──────────────────────────────────────────────────┐ │
│  │ Name | Source | Updated At                        │ │
│  │ Item1| Python | 2024-01-01 10:00                 │ │
│  │ Item2| Node  | 2024-01-01 09:00                 │ │
│  └──────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  Recent Stocks                                          │
│  ┌──────────────────────────────────────────────────┐ │
│  │ Ticker | Name | Market | Updated At              │ │
│  │ AAPL   | Apple| NASDAQ| 2024-01-01 10:00        │ │
│  │ GOOGL  |Google| NASDAQ| 2024-01-01 09:00        │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据刷新**：支持手动刷新按钮
- **时间范围**：支持选择时间范围（7天/30天/全部）
- **数据加载**：显示加载状态，支持骨架屏
- **错误处理**：部分数据加载失败时显示错误提示

**API 调用**：
- `GET /api/bff/v1/views/dashboard`

---

### 2.2 Stocks 列表页

**页面路径**：`/stocks` 或 `/stocks/list`

**页面描述**：股票列表页面，支持搜索、筛选、分页

**功能模块映射**：
- **股票信息管理模块** → 股票查询功能
- **BFF Stocks View** → 股票列表数据

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Stocks | [Search] [Filter] [Refresh] [Update] │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ Ticker | Name | Market | Sector | Updated At    │ │
│  │   ↑    │  ↑   │   ↑    │   ↑    │      ↑         │ │
│  ├──────────────────────────────────────────────────┤ │
│  │ AAPL  │ Apple│ NASDAQ│ Tech  │ 2024-01-01 10:00│ │
│  │ GOOGL │Google│ NASDAQ│ Tech  │ 2024-01-01 09:00│ │
│  │ MSFT  │Micro │ NASDAQ│ Tech  │ 2024-01-01 08:00│ │
│  └──────────────────────────────────────────────────┘ │
│  [< Previous] [1] [2] [3] [Next >]                    │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **搜索功能**：✅ 支持按股票代码、名称搜索（实时搜索，URL参数同步）
- **筛选功能**：✅ 支持按市场（A股/港股/美股）、行业筛选（URL参数同步）
- **排序功能**：✅ 支持按更新时间、市值排序（URL参数同步）
- **分页功能**：✅ 支持分页显示，每页 20/50/100 条（URL参数同步）
- **批量操作**：✅ 支持批量更新、批量删除（复选框选择）
- **详情跳转**：✅ 点击行跳转到股票详情页（`/stocks/{ticker}`）
- **URL同步**：✅ 搜索、筛选、排序、分页参数同步到URL，支持分享和刷新

**实际实现**：
- **页面路径**：`/stocks/list` 或 `/stocks`（通过 `/stocks/index.vue` 重定向）
- **路由参数**：支持 `page`, `page_size`, `ticker`, `name`, `market`, `market_type`, `sector`, `sortBy`, `sortOrder`
- **状态管理**：URL参数与组件状态双向同步

**API 调用**：
- `GET /api/bff/v1/views/stocks?page=1&page_size=20&market=美股`

---

### 2.3 Stocks 详情页

**页面路径**：`/stocks/{ticker}` 或 `/stocks/detail?ticker=AAPL`

**页面描述**：单个股票的详细信息页面

**功能模块映射**：
- **股票信息管理模块** → 股票详情查询
- **BFF Stocks View** → 股票详情数据

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: AAPL - Apple Inc. | [Edit] [Update] [Delete]   │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 基本信息                                          │ │
│  │ Ticker: AAPL                                     │ │
│  │ Name: Apple Inc.                                 │ │
│  │ Market: NASDAQ                                   │ │
│  │ Market Type: 美股                                │ │
│  │ Sector: Technology                               │ │
│  │ Industry: Consumer Electronics                   │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 财务指标                                          │ │
│  │ Market Cap: $3,000,000,000,000                   │ │
│  │ P/E Ratio: 30.5                                  │ │
│  │ P/B Ratio: 45.2                                  │ │
│  │ Dividend Yield: 0.5%                              │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 数据源信息                                        │ │
│  │ Data Source: yfinance                           │ │
│  │ Last Updated: 2024-01-01 10:00:00                │ │
│  │ Created At: 2024-01-01 08:00:00                  │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据更新**：✅ 支持手动触发数据更新（更新按钮，显示更新状态）
- **数据删除**：✅ 支持删除股票记录（删除按钮，确认对话框）
- **返回列表**：✅ 支持返回股票列表页（返回按钮，使用 `router.back()`）
- **404处理**：✅ 股票不存在时显示友好的404提示
- **加载状态**：✅ 显示加载骨架屏和加载状态

**实际实现**：
- **页面路径**：`/stocks/{ticker}`（动态路由，如 `/stocks/AAPL`）
- **路由参数**：`ticker` 从路由参数获取
- **错误处理**：404错误时显示"股票不存在"提示卡片

**API 调用**：
- `GET /api/bff/v1/views/stocks/{ticker}`
- `POST /api/v1/stocks/{ticker}/update`
- `DELETE /api/v1/stocks/{ticker}`

---

### 2.4 Stocks 批量更新页

**页面路径**：`/stocks/batch-update` 或 `/stocks/update`

**页面描述**：批量更新股票数据页面，支持实时进度追踪

**功能模块映射**：
- **实时同步模块** → SSE 实时进度推送
- **股票信息管理模块** → 批量更新功能

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Batch Update Stocks                            │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 更新选项                                          │ │
│  │ ☑ Update All Stocks                             │ │
│  │ ☐ Update Selected Stocks                        │ │
│  │ ☐ Update by Market (A股/港股/美股)              │ │
│  │                                                   │ │
│  │ Delay: [1.0] seconds (0.0 - 10.0)                │ │
│  │                                                   │ │
│  │ [Start Update] [Cancel]                          │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 进度信息                                          │ │
│  │ ████████░░░░░░░░░░ 40%                           │ │
│  │                                                   │ │
│  │ Stage: Fetching                                  │ │
│  │ Message: 正在抓取股票信息... (200/500)          │ │
│  │                                                   │ │
│  │ Total: 500                                       │ │
│  │ Current: 200                                     │ │
│  │ Success: 195                                     │ │
│  │ Failed: 5                                        │ │
│  │                                                   │ │
│  │ Elapsed: 3:20                                    │ │
│  │ Estimated: 5:00                                  │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 失败列表（可选）                                  │ │
│  │ INVALID, ERROR, ...                              │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **更新选项**：✅ 支持全量更新（当前实现），选择更新和按市场更新（待实现）
- **延迟设置**：✅ 支持设置抓取延迟（0.0-10.0 秒，滑块控制）
- **实时进度**：✅ 使用 SSE 实时显示进度（EventSource API）
- **进度可视化**：✅ 进度条、百分比、统计信息（成功/失败数、已耗时、预计剩余时间）
- **阶段显示**：✅ 显示当前阶段（初始化、抓取中、保存中、已完成、错误）
- **操作控制**：✅ 支持取消操作（AbortController）
- **连接状态**：✅ 显示连接状态（连接中、已连接、已断开）

**实际实现**：
- **页面路径**：`/stocks/batch-update`
- **SSE连接**：使用 `EventSource` API 连接到 `/api/v1/stocks/fetch-all?delay={delay}`
- **进度更新**：实时接收进度数据，更新UI状态
- **错误处理**：连接错误、数据错误时显示错误提示

**API 调用**：
- `POST /api/v1/stocks/fetch-all?delay=1.0`（SSE 流式响应）

**技术实现**：
- 前端使用 `EventSource` API 接收 SSE 事件
- 实时更新进度条和统计信息
- 操作完成后显示结果摘要
- 支持取消操作（AbortController）

---

### 2.5 数据支持模块（Stocks 二级模块）🔮

> **说明**：数据支持模块是 Stocks 模块的二级模块，提供历史数据管理、技术指标计算、实时行情展示等功能。

#### 2.5.1 历史数据管理页

**页面路径**：`/stocks/data/history` 或 `/stocks/data/history-management`

**页面描述**：历史K线数据管理页面，支持数据查询、更新、删除、统计

**功能模块映射**：
- **数据支持模块** → 历史K线数据获取与存储
- **数据支持模块** → 历史数据质量保证

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 历史数据管理 | [Refresh] [Update All] [Export]  │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 数据统计                                          │ │
│  │ Total Stocks: 500 | Total Records: 100,000        │ │
│  │ A股: 200 | 港股: 150 | 美股: 150                 │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 查询条件                                          │ │
│  │ Ticker: [____] Market: [All ▼] Period: [日线 ▼] │ │
│  │ Date Range: [2024-01-01] to [2024-12-31]        │ │
│  │ [Search] [Reset]                                 │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 数据列表                                          │ │
│  │ Ticker | Date | Open | High | Low | Close | Vol │ │
│  │ AAPL   | 2024-01-01 | 150 | 155 | 149 | 154 | 1M│ │
│  │ AAPL   | 2024-01-02 | 154 | 156 | 153 | 155 | 1M│ │
│  └──────────────────────────────────────────────────┘ │
│  [< Previous] [1] [2] [3] [Next >]                    │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 数据操作                                          │ │
│  │ [Update Selected] [Delete Selected] [Export CSV] │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据查询**：支持按股票代码、市场、时间周期、日期范围查询
- **数据更新**：支持单只股票更新、批量更新、全量更新
- **数据删除**：支持删除指定时间范围的数据
- **数据统计**：显示数据覆盖范围、数据量统计
- **数据导出**：支持导出为 CSV、Excel 格式
- **数据质量检查**：显示数据质量报告（缺失数据、异常数据）

**API 调用**：
- `GET /api/v1/stocks/data/history?ticker=AAPL&start_date=2024-01-01&end_date=2024-12-31`
- `POST /api/v1/stocks/data/history/update`
- `DELETE /api/v1/stocks/data/history`

---

#### 2.5.2 技术指标计算页

**页面路径**：`/stocks/data/indicators` 或 `/stocks/data/technical-indicators`

**页面描述**：技术指标计算页面，支持指标计算、结果展示、指标可视化

**功能模块映射**：
- **数据支持模块** → 技术指标计算

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 技术指标计算 | [Refresh] [Calculate All]        │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 计算配置                                          │ │
│  │ Ticker: [AAPL]                                   │ │
│  │ Date Range: [2024-01-01] to [2024-12-31]        │ │
│  │ Indicators: ☑ MA ☑ RSI ☑ MACD ☑ Bollinger Bands │ │
│  │                  ☑ KDJ ☑ OBV ☐ CCI ☐ ATR         │ │
│  │ [Calculate] [Reset]                              │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 指标结果 - MA (移动平均线)                        │ │
│  │ Date | MA5 | MA10 | MA20 | MA30 | MA60          │ │
│  │ 2024-01-01 | 150 | 152 | 148 | 145 | 140       │ │
│  │ 2024-01-02 | 151 | 153 | 149 | 146 | 141       │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 指标图表                                          │ │
│  │ [Price + MA Chart]                               │ │
│  │ [RSI Chart] [MACD Chart] [Bollinger Bands Chart]│ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **指标选择**：支持选择多个技术指标（MA、RSI、MACD、布林带等）
- **批量计算**：支持批量计算多只股票的指标
- **结果展示**：表格展示指标数据，支持排序、筛选
- **指标可视化**：图表展示指标趋势（价格+指标叠加图）
- **指标对比**：支持对比不同股票的同一指标
- **数据导出**：支持导出指标数据为 CSV、Excel

**API 调用**：
- `POST /api/v1/stocks/data/indicators/calculate`
- `GET /api/v1/stocks/data/indicators?ticker=AAPL&indicator=MA&start_date=2024-01-01`

---

#### 2.5.3 实时行情展示页

**页面路径**：`/stocks/data/realtime` 或 `/stocks/data/realtime-quotes`

**页面描述**：实时行情展示页面，支持实时价格、涨跌幅、成交量等数据展示

**功能模块映射**：
- **数据支持模块** → 实时交易情况获取

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 实时行情 | [Connect] [Disconnect] [Settings]    │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 连接状态                                          │ │
│  │ Status: 🟢 Connected | Last Update: 10:30:15    │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 实时行情列表                                      │ │
│  │ Ticker | Name | Price | Change | Change% | Vol   │ │
│  │ AAPL   | Apple| 150.5 | +2.5  | +1.69%  | 10M   │ │
│  │ GOOGL  |Google| 2800  | -10   | -0.36%  | 5M    │ │
│  │ MSFT   |Micro | 380   | +5    | +1.33%  | 8M    │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 五档买卖盘（选中股票）                            │ │
│  │ 卖五: 150.8 x 1000                               │ │
│  │ 卖四: 150.7 x 2000                               │ │
│  │ 卖三: 150.6 x 1500                               │ │
│  │ 卖二: 150.55 x 3000                              │ │
│  │ 卖一: 150.5 x 5000                               │ │
│  │ ─────────────────────────────────────────────── │ │
│  │ 买一: 150.45 x 4000                              │ │
│  │ 买二: 150.4 x 2500                               │ │
│  │ 买三: 150.35 x 3000                              │ │
│  │ 买四: 150.3 x 2000                               │ │
│  │ 买五: 150.25 x 1500                              │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **WebSocket连接**：支持连接/断开WebSocket，显示连接状态
- **实时数据推送**：实时接收并更新行情数据（价格、涨跌幅、成交量）
- **数据刷新**：支持手动刷新数据
- **订阅管理**：支持订阅/取消订阅股票（在数据订阅管理页配置）
- **五档买卖盘**：选中股票时显示五档买卖盘数据
- **数据筛选**：支持按市场、涨跌幅筛选
- **数据排序**：支持按价格、涨跌幅、成交量排序

**API 调用**：
- WebSocket: `ws://api/stocks/data/realtime`（实时数据推送）
- `GET /api/v1/stocks/data/realtime?tickers=AAPL,GOOGL,MSFT`（RESTful查询）

---

#### 2.5.4 数据订阅管理页

**页面路径**：`/stocks/data/subscriptions` 或 `/stocks/data/subscription-management`

**页面描述**：实时数据订阅管理页面，支持订阅/取消订阅股票、配置推送频率

**功能模块映射**：
- **数据支持模块** → 实时数据订阅与管理

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 数据订阅管理 | [Add Subscription] [Refresh]    │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 订阅列表                                          │ │
│  │ ☑ AAPL | Apple Inc. | NASDAQ | Push: 1s | Active│ │
│  │ ☑ GOOGL| Google     | NASDAQ | Push: 1s | Active│ │
│  │ ☐ MSFT | Microsoft  | NASDAQ | Push: 5s | Paused│ │
│  │ [Batch Subscribe] [Batch Unsubscribe] [Delete]   │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 添加订阅                                          │ │
│  │ Ticker: [____] or Market: [All Stocks ▼]        │ │
│  │ Push Frequency: [1s ▼] (1s/5s/10s/30s)          │ │
│  │ Data Types: ☑ Price ☑ Volume ☑ Bid/Ask          │ │
│  │ [Subscribe] [Cancel]                             │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 订阅统计                                          │ │
│  │ Total Subscriptions: 50                          │ │
│  │ Active: 45 | Paused: 5                           │ │
│  │ Push Rate: 1000 messages/min                     │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **订阅管理**：支持添加/删除订阅，批量操作
- **订阅配置**：支持配置推送频率（1s/5s/10s/30s）
- **数据类型选择**：支持选择订阅的数据类型（价格、成交量、买卖盘）
- **订阅状态**：显示订阅状态（Active/Paused），支持暂停/恢复
- **订阅统计**：显示订阅数量、推送频率等统计信息
- **市场订阅**：支持订阅整个市场（如所有A股）

**API 调用**：
- `GET /api/v1/stocks/data/subscriptions`
- `POST /api/v1/stocks/data/subscriptions`
- `DELETE /api/v1/stocks/data/subscriptions/{id}`
- `PUT /api/v1/stocks/data/subscriptions/{id}`

---

### 2.6 回测框架模块 🔮

> **说明**：回测框架是独立的一级模块，提供量化交易算法回测功能。

#### 2.6.1 算法列表页

**页面路径**：`/backtesting/algorithms` 或 `/backtesting`

**页面描述**：预设量化交易算法列表页面，支持算法浏览、搜索、筛选

**功能模块映射**：
- **预设量化交易算法** → 算法库开发
- **预设量化交易算法** → 算法管理

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 量化交易算法 | [Search] [Filter] [New]         │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 算法卡片列表                                      │ │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐        │ │
│  │ │ 均线策略 │ │ 动量策略 │ │ RSI策略  │        │ │
│  │ │ MA       │ │ Momentum │ │ RSI      │        │ │
│  │ │ 描述...  │ │ 描述...  │ │ 描述...  │        │ │
│  │ │ [详情]   │ │ [详情]   │ │ [详情]   │        │ │
│  │ └──────────┘ └──────────┘ └──────────┘        │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 筛选条件                                          │ │
│  │ Category: [All ▼] | Market: [All ▼]             │ │
│  │ Strategy Type: [Trend Following ▼]              │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **算法浏览**：卡片式展示算法列表，显示算法名称、描述、类型
- **算法搜索**：支持按算法名称、描述搜索
- **算法筛选**：支持按策略类型、市场、类别筛选
- **算法详情**：点击卡片跳转到算法详情页
- **快速回测**：支持从列表页快速启动回测（使用默认参数）

**API 调用**：
- `GET /api/v1/backtesting/algorithms`
- `GET /api/v1/backtesting/algorithms/{id}`

---

#### 2.6.2 算法详情页

**页面路径**：`/backtesting/algorithms/{id}` 或 `/backtesting/algorithms/{name}`

**页面描述**：算法详细信息页面，展示算法参数、回测历史、性能统计

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 均线策略 (MA Strategy) | [Edit] [Run Backtest]  │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 算法信息                                          │ │
│  │ Name: 均线策略                                    │ │
│  │ Description: 基于移动平均线的趋势跟踪策略        │ │
│  │ Category: Trend Following                        │ │
│  │ Market: A股/港股/美股                             │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 算法参数                                          │ │
│  │ Short MA: 5 | Long MA: 20                        │ │
│  │ Entry Signal: 金叉 | Exit Signal: 死叉           │ │
│  │ Stop Loss: 5% | Take Profit: 10%                 │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 回测历史                                          │ │
│  │ Date | Stocks | Period | Return | Sharpe | MaxDD│ │
│  │ 2024-01-01 | AAPL | 1Y | +15% | 1.2 | -5%       │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 快速操作                                          │ │
│  │ [Run Backtest] [View History] [Edit Parameters]  │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **算法信息展示**：显示算法名称、描述、类别、适用市场
- **参数配置**：显示算法参数（可编辑）
- **回测历史**：显示历史回测记录和结果
- **快速回测**：支持使用默认参数快速启动回测
- **参数编辑**：支持编辑算法参数（保存为新版本）

**API 调用**：
- `GET /api/v1/backtesting/algorithms/{id}`
- `PUT /api/v1/backtesting/algorithms/{id}`
- `GET /api/v1/backtesting/results?algorithm_id={id}`

---

#### 2.6.3 回测配置页

**页面路径**：`/backtesting/configure` 或 `/backtesting/configure?algorithm_id={id}`

**页面描述**：回测配置页面，支持配置回测参数、选择股票、设置时间范围

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 回测配置 | [Save] [Run] [Cancel]              │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 算法选择                                          │ │
│  │ Algorithm: [均线策略 ▼]                           │ │
│  │ [View Details]                                    │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 股票选择                                          │ │
│  │ ☑ Select Stocks                                  │ │
│  │   ☑ AAPL ☑ GOOGL ☑ MSFT ☐ TSLA                  │ │
│  │ ☐ Select by Market (A股/港股/美股)                │ │
│  │ ☐ Select All                                      │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 回测参数                                          │ │
│  │ Start Date: [2024-01-01]                          │ │
│  │ End Date: [2024-12-31]                            │ │
│  │ Initial Capital: [100,000]                        │ │
│  │ Commission Rate: [0.001] (0.1%)                   │ │
│  │ Slippage: [0.0005] (0.05%)                        │ │
│  │ Time Period: [日线 ▼]                             │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 算法参数（根据选择的算法动态显示）                │ │
│  │ Short MA: [5] Long MA: [20]                       │ │
│  │ Stop Loss: [5%] Take Profit: [10%]                 │ │
│  └──────────────────────────────────────────────────┘ │
│  [Run Backtest] [Save Configuration] [Cancel]          │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **算法选择**：支持选择预设算法，查看算法详情
- **股票选择**：支持单选、多选、按市场选择、全选
- **参数配置**：支持配置回测参数（起始资金、手续费率、滑点等）
- **算法参数**：根据选择的算法动态显示算法参数
- **配置保存**：支持保存回测配置（模板），方便下次使用
- **参数验证**：实时验证参数有效性（日期范围、资金等）

**API 调用**：
- `POST /api/v1/backtesting/configure`
- `POST /api/v1/backtesting/run`

---

#### 2.6.4 回测结果页

**页面路径**：`/backtesting/results/{id}` 或 `/backtesting/results?backtest_id={id}`

**页面描述**：回测结果展示页面，显示回测结果摘要、收益曲线、交易记录

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 回测结果 #12345 | [Export] [Share] [Delete]   │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 回测摘要                                          │ │
│  │ Algorithm: 均线策略 | Stocks: AAPL, GOOGL, MSFT │ │
│  │ Period: 2024-01-01 to 2024-12-31                 │ │
│  │ Initial Capital: $100,000                         │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ │
│  │ Total    │ │ Annual   │ │ Sharpe   │ │ Max      │ │
│  │ Return   │ │ Return   │ │ Ratio    │ │ Drawdown │ │
│  │ +25.5%   │ │ +25.5%   │ │ 1.85     │ │ -8.2%    │ │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 收益曲线图                                        │ │
│  │ [Equity Curve Chart]                             │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 回撤曲线图                                        │ │
│  │ [Drawdown Curve Chart]                           │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 交易记录                                          │ │
│  │ Date | Action | Ticker | Price | Quantity | P&L  │ │
│  │ 2024-01-05 | Buy | AAPL | 150 | 100 | -        │ │
│  │ 2024-01-10 | Sell| AAPL | 155 | 100 | +$500    │ │
│  └──────────────────────────────────────────────────┘ │
│  [View Analysis] [Export Report] [Run Again]           │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **结果摘要**：显示回测基本信息、关键指标（总收益、年化收益、夏普比率、最大回撤）
- **收益曲线**：图表展示资产曲线、基准对比
- **回撤曲线**：图表展示回撤曲线
- **交易记录**：表格展示所有交易记录，支持筛选、排序
- **结果导出**：支持导出回测报告（PDF、Excel）
- **结果分享**：支持分享回测结果（生成分享链接）

**API 调用**：
- `GET /api/v1/backtesting/results/{id}`
- `GET /api/v1/backtesting/results/{id}/trades`
- `GET /api/v1/backtesting/results/{id}/export`

---

#### 2.6.5 回测分析页

**页面路径**：`/backtesting/analysis/{id}` 或 `/backtesting/results/{id}/analysis`

**页面描述**：回测深度分析页面，提供详细的收益分析、风险分析、交易分析

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: 回测分析 #12345 | [Export] [Back]              │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ 收益分析                                          │ │
│  │ Total Return: +25.5% | Annual Return: +25.5%     │ │
│  │ Best Month: +8.5% | Worst Month: -5.2%          │ │
│  │ [Monthly Returns Chart]                          │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 风险分析                                          │ │
│  │ Volatility: 15.2% | VaR (95%): -3.5%             │ │
│  │ Max Drawdown: -8.2% | Avg Drawdown: -2.1%       │ │
│  │ [Risk Metrics Chart]                             │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 交易分析                                          │ │
│  │ Total Trades: 120 | Win Rate: 55%                │ │
│  │ Avg Win: +$500 | Avg Loss: -$300                 │ │
│  │ Profit Factor: 1.85 | Avg Hold Time: 5 days      │ │
│  │ [Trade Distribution Chart]                       │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 持仓分析                                          │ │
│  │ [Position Distribution Chart]                    │ │
│  │ [Hold Time Distribution Chart]                   │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **收益分析**：详细收益统计、月度收益分布、收益曲线
- **风险分析**：波动率、VaR、最大回撤、平均回撤等风险指标
- **交易分析**：交易次数、胜率、平均盈亏、盈亏比、平均持仓时间
- **持仓分析**：持仓分布、持仓时间分布
- **图表展示**：多种图表展示分析结果（柱状图、折线图、饼图等）
- **数据导出**：支持导出分析报告

**API 调用**：
- `GET /api/v1/backtesting/results/{id}/analysis`
- `GET /api/v1/backtesting/results/{id}/analysis/returns`
- `GET /api/v1/backtesting/results/{id}/analysis/risk`
- `GET /api/v1/backtesting/results/{id}/analysis/trades`

---

### 2.7 Items 列表页（可选）

**页面路径**：`/items` 或 `/items/list`

**页面描述**：Items 列表页面，聚合三个服务的 Items 数据

**功能模块映射**：
- **数据聚合模块** → Items 聚合功能
- **BFF Items View** → Items 列表数据

**页面结构**：
```
┌─────────────────────────────────────────────────────────┐
│  Header: Items | [Search] [Filter] [Refresh]            │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐ │
│  │ Name | Source | Description | Updated At          │ │
│  │   ↑  │   ↑    │      ↑      │      ↑              │ │
│  ├──────────────────────────────────────────────────┤ │
│  │ Item1| Python| Desc1  | 2024-01-01 10:00        │ │
│  │ Item2| Node  | Desc2  | 2024-01-01 09:00        │ │
│  │ Item3| Rust  | Desc3  | 2024-01-01 08:00        │ │
│  └──────────────────────────────────────────────────┘ │
│  [< Previous] [1] [2] [3] [Next >]                    │
└─────────────────────────────────────────────────────────┘
```

**交互设计**：
- **数据聚合**：自动聚合三个服务的数据
- **去重处理**：按名称去重，保留最新数据
- **排序功能**：按更新时间排序
- **筛选功能**：支持按来源（Python/Node/Rust）筛选

**API 调用**：
- `GET /api/bff/v1/views/items`

---

## 3. 导航与入口关系

### 3.1 主导航（Sidebar）

```
┌─────────────────────┐
│ 🏠 Dashboard         │ → /dashboard
│ 📈 Stocks            │
│   ├─ Stock List      │ → /stocks/list ✅
│   ├─ Batch Update    │ → /stocks/batch-update ✅
│   ├─ Stock Detail    │ → /stocks/{ticker} ✅
│   └─ 数据支持 🔮     │
│       ├─ 历史数据管理 │ → /stocks/data/history
│       ├─ 技术指标计算 │ → /stocks/data/indicators
│       ├─ 实时行情     │ → /stocks/data/realtime
│       └─ 数据订阅管理 │ → /stocks/data/subscriptions
│ 📊 Backtesting 🔮    │
│   ├─ 算法列表        │ → /backtesting/algorithms
│   ├─ 回测配置        │ → /backtesting/configure
│   ├─ 回测结果        │ → /backtesting/results
│   └─ 回测分析        │ → /backtesting/analysis
│ 📋 Items             │
│   └─ Items List      │ → /items
│ ⚙️ Settings          │
│   ├─ Profile         │ → /settings/profile
│   ├─ Appearance      │ → /settings/appearance
│   └─ Notifications   │ → /settings/notifications
└─────────────────────┘
```

**状态说明**：
- ✅ 已实现
- 🔮 规划中

### 3.2 页面跳转关系

```
Dashboard
  ├─→ Stocks List (点击 Recent Stocks)
  ├─→ Items List (点击 Recent Items)
  └─→ Settings

Stocks List ✅
  ├─→ Stock Detail (点击行) ✅
  ├─→ Batch Update (点击批量更新按钮) ✅
  ├─→ 数据支持模块 🔮
  │   ├─→ 历史数据管理
  │   ├─→ 技术指标计算
  │   ├─→ 实时行情
  │   └─→ 数据订阅管理
  └─→ Dashboard (返回)

Stock Detail ✅
  ├─→ Stocks List (返回) ✅
  ├─→ Batch Update (批量更新) ✅
  ├─→ 数据支持模块 🔮
  │   └─→ 技术指标计算 (查看该股票的技术指标)
  └─→ Dashboard (首页)

Batch Update ✅
  ├─→ Stocks List (完成/取消) ✅
  └─→ Dashboard (首页)

数据支持模块 🔮
  ├─→ Stocks List (返回)
  ├─→ Stock Detail (从历史数据/指标跳转到详情)
  └─→ 实时行情 (从订阅管理跳转)

回测框架 🔮
  ├─→ 算法列表
  │   ├─→ 算法详情 (点击算法卡片)
  │   └─→ 回测配置 (快速回测)
  ├─→ 算法详情
  │   ├─→ 回测配置 (运行回测)
  │   └─→ 回测结果 (查看历史回测)
  ├─→ 回测配置
  │   └─→ 回测结果 (运行回测后跳转)
  ├─→ 回测结果
  │   ├─→ 回测分析 (查看详细分析)
  │   └─→ 回测配置 (再次运行)
  └─→ 回测分析
      └─→ 回测结果 (返回)
```

### 3.3 快捷操作入口

- **Dashboard**：
  - 点击 Recent Stocks → 跳转到 Stocks List
  - 点击 Recent Items → 跳转到 Items List
  - 点击统计卡片 → 跳转到对应列表页

- **Stocks List**：
  - 搜索框 → 实时搜索
  - 筛选器 → 按市场/行业筛选
  - 批量更新按钮 → 跳转到 Batch Update

- **Stock Detail**：
  - 更新按钮 → 触发单个股票更新
  - 删除按钮 → 删除股票记录

---

## 4. 信息层级

### 4.1 一级信息（主要信息）

- **Dashboard**：统计数据、最近数据
- **Stocks List**：股票列表
- **Stock Detail**：股票详细信息

### 4.2 二级信息（辅助信息）

- **数据源信息**：显示数据来源（yfinance、akshare 等）
- **更新时间**：显示最后更新时间
- **操作历史**：显示操作记录（可选）

### 4.3 三级信息（详细信息）

- **财务指标**：P/E、P/B、股息率等
- **市场信息**：交易所、国家、货币等
- **元数据**：创建时间、数据源、版本等

---

## 5. 响应式设计

### 5.1 桌面端（≥ 1024px）

- **布局**：侧边栏 + 主内容区
- **表格**：完整表格，支持排序、筛选
- **详情页**：多列布局，信息完整展示

### 5.2 平板端（768px - 1023px）

- **布局**：可折叠侧边栏 + 主内容区
- **表格**：简化表格，关键信息优先
- **详情页**：单列布局，信息堆叠展示

### 5.3 移动端（< 768px）

- **布局**：底部导航 + 主内容区
- **表格**：卡片式列表，支持下拉刷新
- **详情页**：单列布局，信息分组展示

---

## 6. 交互状态

### 6.1 加载状态

- **骨架屏**：数据加载时显示骨架屏
- **加载指示器**：操作进行中显示加载指示器
- **进度条：批量操作显示进度条

### 6.2 错误状态

- **错误提示**：操作失败显示错误提示
- **重试按钮**：支持重试操作
- **降级处理**：部分数据失败时显示可用数据

### 6.3 空状态

- **空列表**：列表为空时显示空状态提示
- **空搜索**：搜索结果为空时显示提示
- **引导操作**：提供操作引导（如"添加股票"）

---

## 7. 页面优先级

### 7.1 P0 - 核心页面（必须）

- ✅ **Dashboard**：系统概览
- ✅ **Stocks List**：股票列表
- ✅ **Stock Detail**：股票详情
- ✅ **Batch Update**：批量更新

### 7.2 P1 - 重要页面（重要）

- ✅ **Items List**：Items 列表（可选，用于测试）
- 🔮 **数据支持模块**（Stocks 二级模块）：
  - 🔮 **历史数据管理页**：历史K线数据管理（P1，Phase 3）
  - 🔮 **技术指标计算页**：技术指标计算和可视化（P1，Phase 3）
  - 🔮 **实时行情展示页**：实时行情数据展示（P1，Phase 3）
  - 🔮 **数据订阅管理页**：实时数据订阅管理（P1，Phase 3）
- 🔮 **回测框架模块**（一级模块）：
  - 🔮 **算法列表页**：算法浏览和搜索（P0，Phase 3）
  - 🔮 **算法详情页**：算法信息和参数（P0，Phase 3）
  - 🔮 **回测配置页**：回测参数配置（P0，Phase 3）
  - 🔮 **回测结果页**：回测结果展示（P0，Phase 3）
  - 🔮 **回测分析页**：回测深度分析（P0，Phase 3）

### 7.3 P2 - 可选页面（可选）

- 🔮 **Settings**：设置页面（已有模板）
- 🔮 **Analytics**：数据分析页面（规划中）

---

---

## 8. 页面实现状态总结

### 8.1 已实现页面（✅）

1. **Dashboard** (`/dashboard` 或 `/`)
   - 统计数据展示
   - 最近 Items 和 Stocks 列表
   - 数据刷新功能

2. **Stocks 列表页** (`/stocks/list` 或 `/stocks`)
   - 搜索、筛选、排序、分页功能
   - 批量操作（批量更新、批量删除）
   - URL 参数同步

3. **Stock 详情页** (`/stocks/{ticker}`)
   - 股票详细信息展示
   - 更新/删除操作
   - 404 错误处理

4. **批量更新页** (`/stocks/batch-update`)
   - SSE 实时进度追踪
   - 进度可视化
   - 操作取消功能

### 8.2 规划中页面（🔮）

#### 数据支持模块（Stocks 二级模块，Phase 3）

1. **历史数据管理页** (`/stocks/data/history`)
   - 历史K线数据查询、更新、删除
   - 数据质量检查
   - 数据统计和导出

2. **技术指标计算页** (`/stocks/data/indicators`)
   - 技术指标计算（MA、RSI、MACD等）
   - 指标结果展示和可视化
   - 批量计算和对比

3. **实时行情展示页** (`/stocks/data/realtime`)
   - WebSocket 实时数据推送
   - 实时价格、涨跌幅、成交量展示
   - 五档买卖盘展示

4. **数据订阅管理页** (`/stocks/data/subscriptions`)
   - 订阅/取消订阅股票
   - 推送频率配置
   - 订阅状态管理

#### 回测框架模块（一级模块，Phase 3）

1. **算法列表页** (`/backtesting/algorithms`)
   - 预设算法浏览和搜索
   - 算法筛选和分类
   - 快速回测入口

2. **算法详情页** (`/backtesting/algorithms/{id}`)
   - 算法信息和参数展示
   - 回测历史记录
   - 参数编辑功能

3. **回测配置页** (`/backtesting/configure`)
   - 算法选择
   - 股票选择
   - 回测参数配置

4. **回测结果页** (`/backtesting/results/{id}`)
   - 回测结果摘要
   - 收益曲线和回撤曲线
   - 交易记录展示

5. **回测分析页** (`/backtesting/analysis/{id}`)
   - 收益分析
   - 风险分析
   - 交易分析
   - 持仓分析

---

**文档维护**：本文档将根据页面开发持续更新  
**最后更新**：2025-01-11  
**更新内容**：
- 对比现有实现，更新 Stocks 模块页面描述
- 添加数据支持模块页面设计（Stocks 二级模块）
- 添加回测框架模块页面设计（一级模块）
