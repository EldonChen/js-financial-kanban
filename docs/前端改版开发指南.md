# 前端改版开发指南

> 本文档为 AI 助手提供前端改版的关键信息，便于后续开发工作参考。

## 项目概述

前端改版的目标是将现有基础 dashboard 改造成管理台应用，支持快速添加新功能，并提前规划 BFF 数据接入层。

## 当前项目结构

```
frontend/
├── app.vue                    # 根组件（当前：简单包装 NuxtPage）
├── nuxt.config.ts             # Nuxt 配置
├── pages/
│   ├── index.vue              # 首页（当前：服务卡片展示）
│   ├── node-items.vue         # Node.js 服务测试页面
│   ├── python-items.vue       # Python 服务测试页面
│   └── rust-items.vue          # Rust 服务测试页面
├── components/
│   └── ServiceCard.vue         # 服务卡片组件
├── composables/
│   └── useApi.ts               # API 调用封装（Fetch API）
├── api/
│   ├── node.ts                 # Node.js 服务 API 封装
│   ├── python.ts               # Python 服务 API 封装
│   └── rust.ts                 # Rust 服务 API 封装
└── assets/
    └── css/
        └── main.css            # 主样式文件
```

## 目标项目结构

```
frontend/
├── app.vue                    # 根组件（使用默认布局）
├── nuxt.config.ts             # Nuxt 配置
├── layouts/
│   ├── default.vue            # 默认布局（带侧边栏）⭐ 新增
│   └── playground.vue         # Playground 专用布局（可选）
├── pages/
│   ├── index.vue              # 首页（管理台概览）⭐ 更新
│   ├── playground/            # Playground 模块 ⭐ 新增
│   │   ├── index.vue          # Playground 入口
│   │   ├── node-items.vue     # Node.js 服务测试（从根目录迁移）
│   │   ├── python-items.vue    # Python 服务测试（从根目录迁移）
│   │   └── rust-items.vue      # Rust 服务测试（从根目录迁移）
│   └── [其他功能模块]/        # 后续可扩展
├── components/
│   ├── ui/                    # shadcn UI 组件 ⭐ 新增
│   ├── layout/                # 布局组件 ⭐ 新增
│   │   ├── Sidebar.vue        # 侧边栏组件
│   │   └── Header.vue         # 顶部 Header（可选）
│   └── [功能组件]/
├── composables/
│   ├── useApi.ts              # API 调用封装（保持）
│   └── useNavigation.ts       # 导航菜单配置 ⭐ 新增
├── api/
│   ├── client.ts              # 统一 API 客户端 ⭐ 新增
│   ├── adapters/              # 适配器层 ⭐ 新增
│   │   ├── direct.ts          # 直接调用后端服务（当前使用）
│   │   └── bff.ts             # BFF 调用（预留）
│   ├── services/              # 服务 API 封装（重构）
│   │   ├── node.ts            # Node.js 服务 API
│   │   ├── python.ts          # Python 服务 API
│   │   └── rust.ts            # Rust 服务 API
│   └── types.ts               # API 类型定义 ⭐ 新增
└── stores/                    # Pinia 状态管理（可选）
    └── [状态管理]/
```

## 关键设计决策

### 1. 布局系统

- **default.vue**：管理台主布局，包含侧边栏和主内容区域
- **playground.vue**：Playground 专用布局（可选，如果样式需要特殊处理）
- 使用 Nuxt Layout 系统，通过 `definePageMeta({ layout: 'default' })` 指定布局

### 2. 导航菜单配置

使用 `composables/useNavigation.ts` 集中管理导航菜单：

```typescript
// composables/useNavigation.ts
export interface NavigationItem {
  title: string
  icon?: string
  path: string
  children?: NavigationItem[]
  permission?: string // 预留，当前不实现
}

export const navigationItems: NavigationItem[] = [
  {
    title: '概览',
    icon: 'Home',
    path: '/',
  },
  {
    title: 'Playground',
    icon: 'Code',
    path: '/playground',
    children: [
      { title: 'Node.js 服务', path: '/playground/node-items' },
      { title: 'Python 服务', path: '/playground/python-items' },
      { title: 'Rust 服务', path: '/playground/rust-items' },
    ],
  },
]

export function useNavigation() {
  const route = useRoute()
  
  const isActive = (path: string) => {
    return route.path === path || route.path.startsWith(path + '/')
  }
  
  return {
    navigationItems,
    isActive,
  }
}
```

### 3. API 适配器模式

**设计目标**：当前直接调用后端服务，后续切换到 BFF 时只需修改适配器，业务代码无需改动。

**接口定义**：
```typescript
// api/types.ts
export interface ApiAdapter {
  get<T>(url: string): Promise<ApiResponse<T>>
  post<T>(url: string, body: any): Promise<ApiResponse<T>>
  put<T>(url: string, body: any): Promise<ApiResponse<T>>
  delete<T>(url: string): Promise<ApiResponse<T>>
}

// api/adapters/direct.ts - 当前使用
export class DirectAdapter implements ApiAdapter {
  async get<T>(url: string): Promise<ApiResponse<T>> {
    return useGet<T>(url) // 复用现有的 useApi.ts
  }
  // ... 其他方法
}

// api/adapters/bff.ts - 预留
export class BffAdapter implements ApiAdapter {
  async get<T>(url: string): Promise<ApiResponse<T>> {
    return useGet<T>(`/api/bff${url}`) // 调用 BFF 服务
  }
  // ... 其他方法
}

// api/client.ts - 统一客户端
export class ApiClient {
  private adapter: ApiAdapter
  
  constructor(adapter: ApiAdapter = new DirectAdapter()) {
    this.adapter = adapter
  }
  
  async get<T>(url: string): Promise<ApiResponse<T>> {
    return this.adapter.get<T>(url)
  }
  // ... 其他方法
}
```

**使用方式**：
```typescript
// api/services/node.ts
const apiClient = new ApiClient(new DirectAdapter()) // 当前使用直接调用

export async function getItems(): Promise<ApiResponse<Item[]>> {
  const config = useRuntimeConfig()
  const baseUrl = config.public.nodeApiUrl
  return apiClient.get<Item[]>(`${baseUrl}/api/v1/items`)
}

// 后续切换到 BFF 时，只需修改：
// const apiClient = new ApiClient(new BffAdapter())
```

### 4. 侧边栏实现

使用 shadcn Sidebar 组件，通过 `shadcn-nuxt` 模块安装。

**配置侧边栏行为**（app.config.ts）：
```typescript
// app.config.ts
export default defineAppConfig({
  appSettings: {
    sidebar: {
      collapsible: 'offcanvas', // 'offcanvas' | 'icon' | 'none'
      side: 'left', // 'left' | 'right'
      variant: 'inset', // 'sidebar' | 'floating' | 'inset'
    },
  },
})
```

**状态管理**（使用 Pinia）：
```typescript
// stores/sidebar.ts
export const useSidebarStore = defineStore('sidebar', () => {
  const isOpen = ref(true)
  
  function toggle() {
    isOpen.value = !isOpen.value
  }
  
  return { isOpen, toggle }
})
```

**使用 Sidebar 组件**：
```vue
<template>
  <Sidebar>
    <SidebarContent>
      <SidebarMenu>
        <SidebarMenuItem>
          <SidebarMenuButton>菜单项</SidebarMenuButton>
        </SidebarMenuItem>
      </SidebarMenu>
    </SidebarContent>
  </Sidebar>
</template>
```

## 开发指南

### 如何添加新功能模块

1. **创建页面文件**：
   ```bash
   # 在 pages/ 目录下创建新页面
   pages/new-feature/index.vue
   ```

2. **更新导航菜单**：
   ```typescript
   // composables/useNavigation.ts
   export const navigationItems: NavigationItem[] = [
     // ... 现有菜单
     {
       title: '新功能',
       icon: 'Star',
       path: '/new-feature',
     },
   ]
   ```

3. **创建 API 服务**（如果需要）：
   ```typescript
   // api/services/new-feature.ts
   const apiClient = new ApiClient(new DirectAdapter())
   
   export async function getData(): Promise<ApiResponse<Data[]>> {
     return apiClient.get<Data[]>(`${baseUrl}/api/v1/data`)
   }
   ```

### 如何使用 shadcn/ui 组件

1. **安装 shadcn-nuxt 模块**：
   ```bash
   pnpm add -D shadcn-nuxt
   ```

2. **配置 Nuxt**：
   ```typescript
   // nuxt.config.ts
   export default defineNuxtConfig({
     modules: [
       'shadcn-nuxt',
       '@nuxt/icon',
       // ... 其他模块
     ],
     shadcn: {
       prefix: '',
       componentDir: '~/components/ui',
     },
   })
   ```

3. **创建 components.json**：
   ```json
   {
     "$schema": "https://shadcn-vue.com/schema.json",
     "style": "new-york",
     "typescript": true,
     "tailwind": {
       "config": "",
       "css": "assets/css/main.css",
       "baseColor": "neutral",
       "cssVariables": true,
       "prefix": ""
     },
     "iconLibrary": "lucide",
     "aliases": {
       "components": "@/components",
       "utils": "@/lib/utils",
       "ui": "@/components/ui",
       "lib": "@/lib",
       "composables": "@/composables"
     }
   }
   ```

4. **安装组件**：
   ```bash
   # 使用 shadcn-nuxt CLI 安装组件
   npx shadcn-nuxt@latest add button
   npx shadcn-nuxt@latest add card
   npx shadcn-nuxt@latest add sidebar
   ```

5. **使用组件**：
   ```vue
   <template>
     <Button>点击</Button>
     <Card>
       <CardHeader>标题</CardHeader>
       <CardContent>内容</CardContent>
     </Card>
   </template>
   ```

### 如何切换 API 适配器

当前使用 `DirectAdapter`，切换到 BFF 时：

```typescript
// api/services/node.ts
// 修改前：
const apiClient = new ApiClient(new DirectAdapter())

// 修改后：
const apiClient = new ApiClient(new BffAdapter())
```

所有使用 `apiClient` 的代码无需修改。

## 参考项目信息

- **GitHub 仓库**：https://github.com/dianprata/nuxt-shadcn-dashboard
- **在线演示**：https://nuxt-shadcn-dashboard.vercel.app
- **项目结构**：使用 `app/` 目录（Nuxt 3.8+）
- **技术栈**：Nuxt 4.1.3、TailwindCSS 4、shadcn-nuxt 2.3.1

## 项目差异对比

### 关键差异

| 项目 | 目录结构 | Nuxt 版本 | TailwindCSS | 说明 |
|------|---------|----------|------------|------|
| 参考项目 | `app/` 目录 | 4.1.3 | 4.1.14 | 完整的管理台模板 |
| 我们的项目 | 根目录 → `app/` 目录 | 3.8+ | 3.x → 4.1.14 | 需要重构 |

### 需要添加的依赖

```bash
# 核心依赖
pnpm add -D shadcn-nuxt
pnpm add reka-ui lucide-vue-next @nuxt/icon
pnpm add -D tailwind-merge clsx class-variance-authority

# TailwindCSS 4
pnpm add -D @tailwindcss/vite tailwindcss@^4.1.14

# 可选依赖
pnpm add @nuxtjs/color-mode @vueuse/nuxt tw-animate-css
```

### 需要从参考项目复用的文件

1. **配置文件**：
   - `app/components.json` → `app/components.json`
   - `app/app.config.ts` → `app/app.config.ts`
   - `nuxt.config.ts` 配置（shadcn 相关）

2. **布局和组件**：
   - `app/layouts/default.vue` → `app/layouts/default.vue`
   - `app/components/layout/` → `app/components/layout/`

3. **工具和配置**：
   - `app/lib/utils.ts` → `app/lib/utils.ts`
   - `app/constants/menus.ts` → `app/constants/menus.ts`（需要适配）
   - `app/types/nav.ts` → `app/types/nav.ts`

4. **样式文件**：
   - `app/assets/css/tailwind.css` → `app/assets/css/tailwind.css`

## 集成步骤

### Step 1: 重构项目结构
1. 创建 `app/` 目录
2. 迁移现有文件到 `app/` 目录
3. 更新 `nuxt.config.ts` 支持 `app/` 目录

### Step 2: 安装依赖
```bash
cd frontend
# 安装所有参考项目的依赖（见上面的依赖列表）
```

### Step 3: 复制配置文件
从参考项目复制：
- `components.json`
- `app.config.ts`
- 更新 `nuxt.config.ts`

### Step 4: 复制布局和组件
从参考项目复制：
- `app/layouts/default.vue`
- `app/components/layout/` 目录
- `app/lib/utils.ts`
- `app/types/nav.ts`

### Step 5: 安装 shadcn 组件
```bash
npx shadcn-nuxt@latest add button
npx shadcn-nuxt@latest add card
npx shadcn-nuxt@latest add sidebar
# ... 其他需要的组件
```

### Step 6: 适配导航菜单
- 复制 `app/constants/menus.ts` 并适配我们的菜单结构
- 更新菜单项，添加 Playground 相关菜单

### Step 7: 迁移现有页面
- 迁移现有页面到 `app/pages/playground/`
- 更新页面使用新布局
- 迁移 API 调用到 `app/api/` 目录

## 技术栈（激进方案：完全对齐参考项目）

- **框架**：Nuxt 3.8+（支持 `app/` 目录结构）
- **UI 组件库**：shadcn/ui + Tailwind CSS 4
  - **shadcn-nuxt**：`shadcn-nuxt@2.3.1+`
  - **底层库**：`reka-ui@^2.5.1`
  - **TailwindCSS 4**：`tailwindcss@^4.1.14` + `@tailwindcss/vite@^4.1.14`
  - **图标库**：`lucide-vue-next@^0.482.0` + `@nuxt/icon@^1.15.0`
  - **工具库**：`tailwind-merge@^2.6.0` + `clsx@^2.1.1` + `class-variance-authority@^0.7.1`
- **状态管理**：Pinia
- **HTTP 客户端**：Fetch API
- **主题切换**：`@nuxtjs/color-mode@^3.5.2`
- **其他工具**：`@vueuse/nuxt@^12.8.2`、`tw-animate-css@^1.4.0`
- **包管理**：pnpm

## 现有 API 端点

### Node.js 服务
- `GET /api/v1/items` - 获取所有 items
- `GET /api/v1/items/{id}` - 获取单个 item
- `POST /api/v1/items` - 创建 item
- `PUT /api/v1/items/{id}` - 更新 item
- `DELETE /api/v1/items/{id}` - 删除 item

### Python 服务
- 同 Node.js 服务（接口相同）

### Rust 服务
- 同 Node.js 服务（接口相同）

## 环境变量

```env
NUXT_PUBLIC_PYTHON_API_URL=http://localhost:8000
NUXT_PUBLIC_NODE_API_URL=http://localhost:3000
NUXT_PUBLIC_RUST_API_URL=http://localhost:8080
```

## 开发命令

```bash
# 开发模式
pnpm dev

# 构建
pnpm build

# 预览
pnpm preview
```

## 常见问题

### Q: 如何添加新的 shadcn/ui 组件？
A: 使用 `shadcn-nuxt` CLI 安装组件：
```bash
npx shadcn-nuxt@latest add button
npx shadcn-nuxt@latest add card
```
组件会自动安装到 `components/ui/` 目录，并确保 Tailwind CSS 配置正确。

### Q: 如何实现路由高亮？
A: 使用 `useRoute()` 获取当前路由，在导航组件中比较路径。

### Q: 如何切换 API 适配器？
A: 修改 `api/services/*.ts` 中的 `ApiClient` 初始化，将 `DirectAdapter` 改为 `BffAdapter`。

### Q: 如何添加新功能模块？
A: 在 `pages/` 目录下创建新页面，在 `composables/useNavigation.ts` 中添加导航菜单项。

### Q: 侧边栏如何实现响应式？
A: 使用 Tailwind CSS 的响应式类（如 `md:block hidden`），在移动端自动折叠。

## 注意事项

1. **Keep it Simple**：优先实现核心功能，避免过度设计
2. **向后兼容**：确保现有功能在改版后仍能正常工作
3. **代码质量**：每个阶段完成后进行代码质量检查
4. **文档更新**：及时更新文档，保持与代码同步
5. **测试验证**：每个功能完成后进行测试验证

## 后续扩展点

1. **权限系统**：在导航配置中添加权限字段
2. **主题切换**：支持暗色/亮色主题
3. **国际化**：支持多语言
4. **性能优化**：代码分割、懒加载等
5. **测试**：添加单元测试和 E2E 测试
