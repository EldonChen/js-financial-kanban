# 技术路线 - 数据支持模块（前端实现）

> **任务状态**：待开始  
> **创建时间**：2025-01-12  
> **文档位置**：docs/  
> **说明**：本文档仅用于当前任务，任务完成后可归档或删除  
> **优先级**：P0 - 最高优先级

## 任务概述

实现数据支持模块的前端页面和交互功能，包括历史数据管理、技术指标计算、数据质量检查、数据同步管理等页面。

## 任务拆解

### 阶段 1：API 封装和基础架构（基础依赖）

#### 任务 1.1：实现 API 服务封装
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级，必须先完成）
- **描述**：创建历史数据、技术指标、数据质量、数据同步的 API 服务封装
- **内容**：
  - 创建 `frontend/app/api/services/historical-data.ts`
  - 创建 `frontend/app/api/services/indicators.ts`
  - 创建 `frontend/app/api/services/data-quality.ts`
  - 创建 `frontend/app/api/services/data-sync.ts`
  - 实现所有 API 方法（与 BFF 层接口对应）
  - 实现 SSE 支持（使用 EventSource API）
  - 实现错误处理
- **验收标准**：
  - [ ] 所有 API 服务封装完成
  - [ ] 可以正常调用 BFF 层接口
  - [ ] SSE 支持正常工作
  - [ ] 错误处理完善
- **输出**：
  - `frontend/app/api/services/historical-data.ts`
  - `frontend/app/api/services/indicators.ts`
  - `frontend/app/api/services/data-quality.ts`
  - `frontend/app/api/services/data-sync.ts`

#### 任务 1.2：实现类型定义和 Composables
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：扩展类型定义，创建 Composables 封装
- **内容**：
  - 在 `frontend/app/api/types.ts` 中添加新类型定义（HistoricalData, IndicatorData, DataQualityResult 等）
  - 创建 `frontend/app/composables/useHistoricalData.ts`
  - 创建 `frontend/app/composables/useIndicators.ts`
  - 创建 `frontend/app/composables/useDataQuality.ts`
  - 创建 `frontend/app/composables/useDataSync.ts`
  - 更新 `frontend/app/composables/useApi.ts`（添加新服务）
- **验收标准**：
  - [ ] 所有类型定义完整
  - [ ] Composables 可以正常使用
  - [ ] 与现有代码风格保持一致
- **输出**：
  - 更新后的 `frontend/app/api/types.ts`
  - `frontend/app/composables/useHistoricalData.ts`
  - `frontend/app/composables/useIndicators.ts`
  - `frontend/app/composables/useDataQuality.ts`
  - `frontend/app/composables/useDataSync.ts`
  - 更新后的 `frontend/app/composables/useApi.ts`

### 阶段 2：基础组件实现（可复用组件）

#### 任务 2.1：实现 K线图组件
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：使用 ECharts 实现 K线图组件
- **内容**：
  - 安装 ECharts 依赖（`echarts` 和 `vue-echarts`）
  - 创建 `frontend/app/components/stocks/KlineChart.vue`
  - 实现 K线图渲染（candlestick 图表）
  - 实现缩放和平移功能
  - 实现时间周期切换
  - 实现技术指标叠加显示（可选）
- **验收标准**：
  - [ ] K线图可以正常渲染
  - [ ] 缩放和平移功能正常
  - [ ] 时间周期切换正常
  - [ ] 性能满足要求（大数据量不卡顿）
- **输出**：`frontend/app/components/stocks/KlineChart.vue`

#### 任务 2.2：实现指标图表组件
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：使用 ECharts 实现指标图表组件
- **内容**：
  - 创建 `frontend/app/components/stocks/IndicatorChart.vue`
  - 实现 K线图 + 指标叠加显示
  - 实现指标切换功能
  - 实现时间周期切换
  - 实现缩放和平移功能
- **验收标准**：
  - [ ] 指标图表可以正常渲染
  - [ ] 指标叠加显示正常
  - [ ] 指标切换功能正常
  - [ ] 性能满足要求
- **依赖**：任务 2.1（可以复用 K线图逻辑）
- **输出**：`frontend/app/components/stocks/IndicatorChart.vue`

#### 任务 2.3：实现数据质量卡片组件
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐（重要）
- **描述**：实现数据质量检查结果展示卡片组件
- **内容**：
  - 创建 `frontend/app/components/stocks/DataQualityCard.vue`
  - 实现状态显示（通过/警告/失败）
  - 实现数量显示
  - 实现点击查看详情功能
  - 使用 Shadcn UI 组件（Card, Badge）
- **验收标准**：
  - [ ] 卡片可以正常显示
  - [ ] 状态和数量显示正确
  - [ ] 点击查看详情功能正常
- **输出**：`frontend/app/components/stocks/DataQualityCard.vue`

#### 任务 2.4：实现 SSE 进度组件
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐（重要）
- **描述**：实现 SSE 实时进度展示组件
- **内容**：
  - 创建 `frontend/app/components/common/SSEProgress.vue`
  - 实现进度条显示
  - 实现统计信息显示（总数、成功数、失败数）
  - 实现预计剩余时间显示
  - 实现阶段状态显示（init, fetching, saving, completed, error）
  - 使用 Shadcn UI 组件（Progress, Card）
- **验收标准**：
  - [ ] 进度条可以正常显示
  - [ ] 统计信息显示正确
  - [ ] 预计剩余时间计算正确
  - [ ] 阶段状态显示正确
- **输出**：`frontend/app/components/common/SSEProgress.vue`

### 阶段 3：历史数据管理页实现（核心页面）

#### 任务 3.1：实现历史数据管理页基础功能
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：创建历史数据管理页，实现查询和统计功能
- **内容**：
  - 创建 `frontend/app/pages/stocks/data/history.vue`
  - 实现查询条件表单（股票代码/名称、时间周期、时间范围）
  - 实现查询功能（调用 API）
  - 实现数据统计卡片展示（总数、覆盖率、缺失数、最新日期）
  - 实现数据列表展示（表格形式）
  - 实现分页功能
  - 实现 URL 参数同步（查询条件同步到 URL）
- **验收标准**：
  - [ ] 查询功能正常工作
  - [ ] 数据统计显示正确
  - [ ] 数据列表显示正确
  - [ ] 分页功能正常
  - [ ] URL 参数同步正常
- **依赖**：任务 1.1, 1.2
- **输出**：`frontend/app/pages/stocks/data/history.vue`

#### 任务 3.2：实现历史数据管理页 K线图和更新功能
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：在历史数据管理页中集成 K线图和更新功能
- **内容**：
  - 集成 K线图组件（任务 2.1）
  - 实现单只股票更新功能
  - 实现批量更新功能（使用 SSE 进度组件）
  - 实现全量更新功能（使用 SSE 进度组件）
  - 实现删除功能
  - 实现数据刷新功能
- **验收标准**：
  - [ ] K线图可以正常显示
  - [ ] 更新功能正常工作
  - [ ] SSE 进度显示正常
  - [ ] 删除功能正常
- **依赖**：任务 2.1, 2.4, 3.1
- **输出**：更新后的 `frontend/app/pages/stocks/data/history.vue`

### 阶段 4：技术指标计算页实现（核心页面）

#### 任务 4.1：实现技术指标计算页基础功能
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：创建技术指标计算页，实现指标计算和查询功能
- **内容**：
  - 创建 `frontend/app/pages/stocks/data/indicators.vue`
  - 实现计算条件表单（股票代码/名称、时间周期、指标类型、时间范围）
  - 实现指标计算功能（调用 API）
  - 实现指标查询功能
  - 实现支持的指标列表展示（卡片形式）
  - 实现指标数据列表展示（表格形式）
  - 实现分页功能
- **验收标准**：
  - [ ] 指标计算功能正常工作
  - [ ] 指标查询功能正常工作
  - [ ] 支持的指标列表显示正确
  - [ ] 指标数据列表显示正确
- **依赖**：任务 1.1, 1.2
- **输出**：`frontend/app/pages/stocks/data/indicators.vue`

#### 任务 4.2：实现技术指标计算页图表和批量计算功能
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：在技术指标计算页中集成指标图表和批量计算功能
- **内容**：
  - 集成指标图表组件（任务 2.2）
  - 实现批量指标计算功能（使用 SSE 进度组件）
  - 实现指标切换功能
  - 实现时间周期切换功能
  - 实现数据刷新功能
- **验收标准**：
  - [ ] 指标图表可以正常显示
  - [ ] 批量计算功能正常工作
  - [ ] 指标切换功能正常
  - [ ] SSE 进度显示正常
- **依赖**：任务 2.2, 2.4, 4.1
- **输出**：更新后的 `frontend/app/pages/stocks/data/indicators.vue`

### 阶段 5：数据质量检查页实现（重要页面）

#### 任务 5.1：实现数据质量检查页
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐（重要）
- **描述**：创建数据质量检查页，实现质量检查和修复功能
- **内容**：
  - 创建 `frontend/app/pages/stocks/data/quality.vue`
  - 实现检查条件表单（股票代码/名称、时间周期、时间范围）
  - 实现质量检查功能（调用 API）
  - 集成数据质量卡片组件（任务 2.3）
  - 实现质量报告展示（问题详情列表）
  - 实现自动修复功能（使用 SSE 进度组件）
  - 实现手动修复功能
- **验收标准**：
  - [ ] 质量检查功能正常工作
  - [ ] 质量报告显示正确
  - [ ] 自动修复功能正常
  - [ ] 手动修复功能正常
- **依赖**：任务 1.1, 1.2, 2.3, 2.4
- **输出**：`frontend/app/pages/stocks/data/quality.vue`

### 阶段 6：数据同步管理页实现（重要页面）

#### 任务 6.1：实现数据同步管理页
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐（重要）
- **描述**：创建数据同步管理页，实现同步状态查看和手动同步功能
- **内容**：
  - 创建 `frontend/app/pages/stocks/data/sync.vue`
  - 实现同步状态展示（上次同步时间、下次同步时间、同步状态）
  - 实现手动同步功能（配置对话框 + SSE 进度组件）
  - 实现同步任务列表展示（表格形式）
  - 实现任务详情查看功能
  - 实现任务取消功能
- **验收标准**：
  - [ ] 同步状态显示正确
  - [ ] 手动同步功能正常工作
  - [ ] 同步任务列表显示正确
  - [ ] SSE 进度显示正常
- **依赖**：任务 1.1, 1.2, 2.4
- **输出**：`frontend/app/pages/stocks/data/sync.vue`

### 阶段 7：导航和路由配置（集成）

#### 任务 7.1：更新导航菜单和路由配置
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐⭐（最高优先级）
- **描述**：在导航菜单中添加数据支持模块，配置路由
- **内容**：
  - 更新 `frontend/app/constants/menus.ts`（在 Stocks 菜单下添加"数据支持"子菜单）
  - 确保路由配置正确（Nuxt 3 自动路由）
  - 测试所有页面可以正常访问
  - 测试页面跳转正常
- **验收标准**：
  - [ ] 导航菜单显示正确
  - [ ] 所有页面可以正常访问
  - [ ] 页面跳转正常
- **依赖**：任务 3.2, 4.2, 5.1, 6.1
- **输出**：更新后的 `frontend/app/constants/menus.ts`

### 阶段 8：测试和优化（质量保证）

#### 任务 8.1：功能测试和优化
- **状态**：待开始
- **优先级**：⭐⭐⭐⭐（重要）
- **描述**：进行功能测试，优化用户体验
- **内容**：
  - 测试所有页面功能
  - 测试 SSE 进度显示
  - 测试错误处理
  - 优化加载状态显示
  - 优化错误提示
  - 优化用户体验（添加操作成功提示、确认对话框等）
- **验收标准**：
  - [ ] 所有功能正常工作
  - [ ] 用户体验良好
  - [ ] 错误处理完善
- **依赖**：任务 7.1
- **输出**：测试报告和优化记录

#### 任务 8.2：性能优化
- **状态**：待开始
- **优先级**：⭐⭐⭐（可选）
- **描述**：进行性能优化
- **内容**：
  - 优化大数据量查询（使用分页、虚拟滚动）
  - 优化图表渲染性能（数据采样、按需渲染）
  - 优化 SSE 连接管理（及时关闭）
  - 优化组件加载（懒加载、代码分割）
- **验收标准**：
  - [ ] 大数据量查询性能满足要求
  - [ ] 图表渲染性能满足要求
  - [ ] 页面加载速度满足要求
- **依赖**：任务 8.1
- **输出**：性能优化报告

## 任务依赖关系图

```
阶段 1：API 封装和基础架构
├── 任务 1.1：API 服务封装
└── 任务 1.2：类型定义和 Composables

阶段 2：基础组件实现
├── 任务 2.1：K线图组件
├── 任务 2.2：指标图表组件（依赖 2.1）
├── 任务 2.3：数据质量卡片组件
└── 任务 2.4：SSE 进度组件

阶段 3：历史数据管理页实现
├── 任务 3.1：历史数据管理页基础功能（依赖 1.1, 1.2）
└── 任务 3.2：历史数据管理页 K线图和更新功能（依赖 2.1, 2.4, 3.1）

阶段 4：技术指标计算页实现
├── 任务 4.1：技术指标计算页基础功能（依赖 1.1, 1.2）
└── 任务 4.2：技术指标计算页图表和批量计算功能（依赖 2.2, 2.4, 4.1）

阶段 5：数据质量检查页实现
└── 任务 5.1：数据质量检查页（依赖 1.1, 1.2, 2.3, 2.4）

阶段 6：数据同步管理页实现
└── 任务 6.1：数据同步管理页（依赖 1.1, 1.2, 2.4）

阶段 7：导航和路由配置
└── 任务 7.1：更新导航菜单和路由配置（依赖 3.2, 4.2, 5.1, 6.1）

阶段 8：测试和优化
├── 任务 8.1：功能测试和优化（依赖 7.1）
└── 任务 8.2：性能优化（依赖 8.1）
```

## 注意事项

1. **向后兼容**：
   - 所有新页面不影响现有页面
   - 使用独立的路由路径（`/stocks/data/*`）
   - 使用独立的组件，不影响现有组件

2. **代码规范**：
   - 遵循现有代码风格（与 `stocks/list.vue` 保持一致）
   - 使用 TypeScript 类型定义
   - 组件和函数命名清晰

3. **用户体验**：
   - 所有异步操作显示加载状态
   - 错误信息友好提示
   - 操作成功提示
   - 重要操作添加确认对话框

4. **性能优化**：
   - 大数据量查询使用分页
   - 图表数据使用虚拟滚动（如果数据量很大）
   - SSE 连接及时关闭，避免资源浪费

5. **组件复用**：
   - K线图组件和指标图表组件可以复用
   - SSE 进度组件可以在多个页面复用
   - 数据质量卡片组件可以在多个场景复用

## 检查清单

### 代码质量检查
- [ ] 所有代码通过 lint 检查
- [ ] 所有代码通过类型检查
- [ ] 组件和函数命名清晰
- [ ] 代码注释完整

### 功能完整性检查
- [ ] 历史数据管理页功能完整
- [ ] 技术指标计算页功能完整
- [ ] 数据质量检查页功能完整
- [ ] 数据同步管理页功能完整
- [ ] 所有 API 调用正常工作
- [ ] SSE 进度显示正常

### 用户体验检查
- [ ] 加载状态显示正确
- [ ] 错误提示友好
- [ ] 操作成功提示正常
- [ ] 页面跳转流畅

### 兼容性检查
- [ ] 不影响现有页面
- [ ] 向后兼容性保证
- [ ] 浏览器兼容性测试通过

---

**技术路线规划已完成**

**参考文档**：
- `docs/技术方案设计-数据支持模块-前端实现.md`（技术方案设计）
- `docs/技术方案设计-数据支持模块-BFF层实现.md`（BFF 层 API 设计）
